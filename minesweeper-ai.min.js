function simulate(e,r,n){function t(e,r){for(var n in r)e[n]=r[n];return e}var o,a={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},i={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0},l=t(i,arguments[2]||{}),u=null;void 0==n&&(n=l.button);for(var c in a)if(a[c].test(r)){u=c;break}if(!u)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");if(document.createEvent)o=document.createEvent(u),"HTMLEvents"==u?o.initEvent(r,l.bubbles,l.cancelable):o.initMouseEvent(r,l.bubbles,l.cancelable,document.defaultView,l.button,l.pointerX,l.pointerY,l.pointerX,l.pointerY,l.ctrlKey,l.altKey,l.shiftKey,l.metaKey,n,e),e.dispatchEvent(o);else{l.clientX=l.pointerX,l.clientY=l.pointerY;var g=document.createEventObject();o=t(g,l),e.fireEvent("on"+r,o)}return e}function simulateClick(e,r){simulate(e,"mousedown",r),simulate(e,"mouseup",r)}function setup(){$("#solve-link")[0]||$("#game-container").prepend('<span id="solve-link" style="color:blue;text-decoration:underline;cursor:pointer;">Solve</span> | '),$("#solve-link").on("click",solveGame)}function isGameOver(){return void 0!=$(".facedead")[0]}function isGameWon(){return void 0!=$(".facewin")[0]}function newGame(){simulateClick($("#face")[0])}function chooseTile(e){simulateClick(e.div)}function placeFlag(e){return e.div.classList.contains("bombflagged")?!1:(simulateClick(e.div,2),!0)}function getBoard(){for(var e=$.map($(".square").not(":hidden"),function(e){var r=e.id.split("_").map(function(e){return parseInt(e)}),n=e.classList[1];return{flag:"bombflagged"==n,value:n.indexOf("open")>-1?parseInt(n.split("open")[1]):-1,x:r[0],y:r[1],div:e}}),r=new Array,n=0;n<e.length;n++){var t=e[n];r[t.x]||(r[t.x]=new Array),r[t.x][t.y]=t}return r}function getTiles(){return getBoard().reduce(function(e,r){return e.concat(r)}).filter(function(e){return e})}function solveGame(){var e=0;for((isGameWon()||isGameOver())&&newGame(),getTiles().length==getBlankTiles().length&&pickRandomTile();!isGameWon()&&!isGameOver();){for(var r=[clearObviousTiles,flag12,clear11,chooseSafestTile,pickRandomTile],n=0;n<r.length;n++){var t=r[n]();t&&(n=r.length)}console.log(++e)}}function pickRandomTile(){var e=getBlankTiles();chooseTile(e[Math.ceil(Math.random()*e.length)]),console.log("pickRandomTile")}function getNeighbors(e,r){r||(r=getBoard());for(var n=[],t=e.x-1||e.x;t<=(e.x+1<r.length?e.x+1:e.x);t++)for(var o=e.y-1||e.y;o<=(e.y+1<r[t].length?e.y+1:e.y);o++)(t!=e.x||o!=e.y)&&n.push(r[t][o]);return n}function getBlankNeighbors(e,r){return r||(r=getBoard()),getNeighbors(e,r).filter(function(e){return e.value<0&&!e.flag})}function getFlagNeighbors(e,r){return r||(r=getBoard()),getNeighbors(e,r).filter(function(e){return e.flag})}function getNumberedNeighbors(e,r){return r||(r=getBoard()),getNeighbors(e,r).filter(function(e){return e.value>=0&&!e.flag})}function getBlankTiles(){return getTiles().filter(function(e){return e.value<0&&!e.flag})}function getNumberedTiles(e){return getTiles(e).filter(function(e){return e.value>0})}function getValue(e,r){return r||(r=getBoard()),e.value-getFlagNeighbors(e,r).length}function clearObviousTiles(){for(var e=!1,r=getBoard(),n=getNumberedTiles(r).sort(function(e,r){return e.value-r.value}),t=0;t<n.length;t++){r=getBoard();var o=getBlankNeighbors(n[t],r),a=getValue(n[t],r);if(0==a)for(var i=0;i<o.length;i++)e=!0,chooseTile(o[i]);else if(a==o.length)for(var i=0;i<o.length;i++)placeFlag(o[i])&&(e=!0)}return e&&console.log("clearObviousTiles"),e}function flag12(){var e=!1,r=getBoard(),n=[r,rotateBoard(r)];return n.forEach(function(r){for(var n=1;n<r.length;n++){var t=r[n].slice(1).map(function(e){var r=getValue(e);return 0>r?"x":r}).reduce(function(e,r){return e+""+r});t="x"+t+"x";for(var o=1;o>0;){var a=t.indexOf("12",o);if(-1!=a&&a!=t.indexOf("12x",o)){var i=getBlankNeighbors(r[n][a]),l=getBlankNeighbors(r[n][a+1]),u=getUniqueArray(l,i);1==u.length&&placeFlag(u[0])&&(e=!0)}o=a+1}for(var o=1;o>0;){var a=t.indexOf("21",o);if(-1!=a&&a-1!=t.indexOf("x21",o-1)){var i=getBlankNeighbors(r[n][a]),l=getBlankNeighbors(r[n][a+1]),u=getUniqueArray(i,l);1==u.length&&placeFlag(u[0])&&(e=!0)}o=a+1}}}),e&&console.log("flag12"),e}function clear11(){var e=!1,r=getBoard(),n=[r,rotateBoard(r)];return n.forEach(function(r){boardString=r.map(function(e){var r=e.slice(1).map(function(e){var r=getValue(e);return 0>r?"x":r}).reduce(function(e,r){return e+""+r});return"0"+r+"0"}),boardString[0]="",boardString[boardString.length]="";for(var n=1;n<boardString.length;n++){rowString=boardString[n];for(var t=1;t>0;){var o=rowString.indexOf("11",t);if(-1!=o&&o!=rowString.indexOf("11x",t)&&o-1!=rowString.indexOf("x11",t)){var a=patternChecker11(boardString,n,o);if(a){var i=[getBlankNeighbors(r[n][o]),getBlankNeighbors(r[n][o+1])],l=getUniqueArray(i[a%2],i[(a+1)%2]);1==l.length&&(chooseTile(l[0]),e=!0)}}t=o+1}}}),e&&console.log("clear11"),e}function patternChecker11(e,r,n){return"x"!=e[r-1].charAt(n-1)&&"x"!=e[r+1].charAt(n-1)?1:"x"!=e[r-1].charAt(n+2)&&"x"!=e[r+1].charAt(n+2)?2:0}function getUniqueArray(e,r){return e.filter(function(e){return-1==r.map(function(e){return e.div}).indexOf(e.div)})}function rotateBoard(e){for(var r=new Array,n=1;n<e[1].length;n++)r[n]=new Array;for(var t=1;t<e.length;t++)for(var n=1;n<e[t].length;n++)r[n][t]=e[t][n];return r}function areNeighbors(e,r){return[e.x-1,e.x,e.x+1].indexOf(r.x)>=0&&[e.y-1,e.y,e.y+1].indexOf(r.y)>=0}function isBorderTile(e,r,n){if(e[r][n].value>=0||e[r][n].flag)return!1;var t=!1,o=!1,a=!1,i=!1;return 1==r&&(t=!0),r==e.length-1&&(o=!0),1==n&&(a=!0),n==e[1].length-1&&(i=!0),!t&&e[r-1][n].value>=0||!a&&e[r][n-1].value>=0||!o&&e[r+1][n].value>=0||!i&&e[r][n+1].value>=0||!t&&!a&&e[r-1][n-1].value>=0||!t&&!i&&e[r-1][n+1].value>=0||!o&&!a&&e[r+1][n-1].value>=0||!o&&!i&&e[r+1][n+1].value>=0}function getBorderTiles(e){return e||(e=getBoard()),getBlankTiles().filter(function(r){return isBorderTile(e,r.x,r.y)})}function distance(e,r){var n=e.x-r.x,t=e.y-r.y;return Math.sqrt(n*n+t*t)}function getBorderTilesByRegion(e){var r=getBorderTiles(),n=new Array,t=r[0],o=new Array;for(o.push(t),r=r.slice(1);r.length>0;)r.sort(function(e,r){return distance(t,e)-distance(t,r)}),areNeighbors(t,r[0])||(n.push(o),o=new Array),o.push(r[0]),t=r[0],r=r.slice(1);return n.push(o),n}function getSmallestBorderTileRegion(e){return e||(e=getBoard()),getBorderTilesByRegion(e).sort(function(e,r){return e.length-r.length}).filter(function(e){return e.length>1})[0]}function isValidBoard(e){for(var r=getNumberedTiles(e),n=0;n<r.length;n++){var t=(getBlankNeighbors(r[n],e),getValue(r[n],e));if(0>t)return!1}return!0}function getPossibleBoards(e,r){e||(e=getBoard()),r||(r=getSmallestBorderTileRegion(e)),r&&r.length>10&&r.splice(9);var n,t=new Array;r&&r.length>0&&(n=combine(r,1),n.sort(function(e,r){return r.length-e.length}));for(var o=0;o<n.length;o++){for(var a=JSON.parse(JSON.stringify(e)),i=0;i<n[o].length;i++)a[n[o][i].x][n[o][i].y].flag=!0;isValidBoard(a)&&t.push(a)}return t}function chooseSafestTile(){for(var e=!1,r=getSmallestBorderTileRegion(),n=getPossibleBoards(),t=getBoard(),o=0;o<r.length;o++){var a=r[o];a.aValue=0,t[a.x][a.y].aValue=0;for(var i=0;i<n.length;i++)n[i][a.x][a.y].flag&&(a.aValue++,t[a.x][a.y].aValue++)}var l=t.reduce(function(e,r){return e.concat(r)}).filter(function(e){return e.aValue});return l.sort(function(e,r){return e.aValue-r.aValue}),l[0]&&(e=!0),chooseTile(l[0]),e&&console.log("chooseSafestTile"),e}var combine=function(e,r){for(var n=function(e,r,t,o){if(0==e)return void(t.length>0&&(o[o.length]=t));for(var a=0;a<r.length;a++)n(e-1,r.slice(a+1),t.concat([r[a]]),o)},t=[],o=r;o<e.length;o++)n(o,e,[],t);return t.push(e),t};setup();