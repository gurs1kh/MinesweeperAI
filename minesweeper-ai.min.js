function simulate(e,n,t){function r(e,n){for(var t in n)e[t]=n[t];return e}var i,o={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},l={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0},a=r(l,arguments[2]||{}),u=null;void 0==t&&(t=a.button);for(var s in o)if(o[s].test(n)){u=s;break}if(!u)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");if(document.createEvent)i=document.createEvent(u),"HTMLEvents"==u?i.initEvent(n,a.bubbles,a.cancelable):i.initMouseEvent(n,a.bubbles,a.cancelable,document.defaultView,a.button,a.pointerX,a.pointerY,a.pointerX,a.pointerY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,t,e),e.dispatchEvent(i);else{a.clientX=a.pointerX,a.clientY=a.pointerY;var c=document.createEventObject();i=r(c,a),e.fireEvent("on"+n,i)}return e}function simulateClick(e,n){simulate(e,"mousedown",n),simulate(e,"mouseup",n)}function setup(){$("#solve-link")[0]||$("#game-container").prepend('<span id="solve-link" style="color:blue;text-decoration:underline;cursor:pointer;">Solve</span> | '),$("#solve-link").on("click",solveGame)}function isGameOver(){return void 0!=$(".facedead")[0]}function isGameWon(){return void 0!=$(".facewin")[0]}function newGame(){simulateClick($("#face")[0])}function chooseTile(e){simulateClick(e.div)}function placeFlag(e){simulateClick(e.div,2)}function getBoard(){for(var e=$.map($(".square").not(":hidden"),function(e){var n=e.id.split("_").map(function(e){return parseInt(e)}),t=e.classList[1];return{flag:"bombflagged"==t,value:t.indexOf("open")>-1?parseInt(t.split("open")[1]):-1,x:n[0],y:n[1],div:e}}),n=new Array,t=0;t<e.length;t++){var r=e[t];n[r.x]||(n[r.x]=new Array),n[r.x][r.y]=r}return n}function getTiles(){return getBoard().reduce(function(e,n){return e.concat(n)}).filter(function(e){return e})}function solveGame(){for((isGameWon()||isGameOver())&&newGame(),getTiles().length==getBlankTiles().length&&pickRandomTile();!isGameWon()&&!isGameOver();)console.log(isGameOver(),isGameWon()),clearObviousTiles()||chooseMostLikelyTile()||pickRandomTile()}function pickRandomTile(){var e=getBlankTiles();chooseTile(e[Math.ceil(Math.random()*e.length)])}function getNeighbors(e,n){for(var t=[],r=n.x-1||n.x;r<=(n.x+1<e.length?n.x+1:n.x);r++)for(var i=n.y-1||n.y;i<=(n.y+1<e[r].length?n.y+1:n.y);i++)(r!=n.x||i!=n.y)&&t.push(e[r][i]);return t}function getBlankNeighbors(e,n){return getNeighbors(e,n).filter(function(e){return e.value<0&&!e.flag})}function getFlagNeighbors(e,n){return getNeighbors(e,n).filter(function(e){return e.flag})}function getNumberedNeighbors(e,n){return getNeighbors(e,n).filter(function(e){return e.value>=0&&!e.flag})}function getBlankTiles(){return getTiles().filter(function(e){return e.value<0&&!e.flag})}function getNumberedTiles(e){return getTiles(e).filter(function(e){return e.value>0})}function clearObviousTiles(){for(var e=!1,n=getBoard(),t=getNumberedTiles(n).sort(function(e,n){return e.value-n.value}),r=0;r<t.length;r++){n=getBoard();var i=getBlankNeighbors(n,t[r]),o=getFlagNeighbors(n,t[r]),l=t[r].value-o.length;if(0==l)for(var a=0;a<i.length;a++)e=!0,chooseTile(i[a]);else if(l==i.length)for(var a=0;a<i.length;a++)e=!0,placeFlag(i[a])}return e}function areNeighbors(e,n){return[e.x-1,e.x,e.x+1].indexOf(n.x)>=0&&[e.y-1,e.y,e.y+1].indexOf(n.y)>=0}function isBorderTile(e,n,t){if(e[n][t].value>=0||e[n][t].flag)return!1;var r=!1,i=!1,o=!1,l=!1;return 1==n&&(r=!0),n==e.length-1&&(i=!0),1==t&&(o=!0),t==e[1].length-1&&(l=!0),!r&&e[n-1][t].value>=0||!o&&e[n][t-1].value>=0||!i&&e[n+1][t].value>=0||!l&&e[n][t+1].value>=0||!r&&!o&&e[n-1][t-1].value>=0||!r&&!l&&e[n-1][t+1].value>=0||!i&&!o&&e[n+1][t-1].value>=0||!i&&!l&&e[n+1][t+1].value>=0}function getBorderTiles(e){return e||(e=getBoard()),getBlankTiles().filter(function(n){return isBorderTile(e,n.x,n.y)})}function distance(e,n){var t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)}function getBorderTilesByRegion(e){var n=getBorderTiles(),t=new Array,r=n[0],i=new Array;for(i.push(r),n=n.slice(1);n.length>0;)n.sort(function(e,n){return distance(r,e)-distance(r,n)}),areNeighbors(r,n[0])||(t.push(i),i=new Array),i.push(n[0]),r=n[0],n=n.slice(1);return t.push(i),t}function getSmallestBorderTileRegion(e){return e||(e=getBoard()),getBorderTilesByRegion(e).sort(function(e,n){return e.length-n.length}).filter(function(e){return e.length>1})[0]}function isValidBoard(e){for(var n=getNumberedTiles(e),t=0;t<n.length;t++){var r=(getBlankNeighbors(e,n[t]),getFlagNeighbors(e,n[t])),i=n[t].value-r.length;if(0>i)return!1}return!0}function getPossibleBoards(e,n){e||(e=getBoard()),n||(n=getSmallestBorderTileRegion(e)),n&&n.length>10&&n.splice(9);var t,r=new Array;n&&n.length>0&&(t=combine(n,1),t.sort(function(e,n){return n.length-e.length}));for(var i=0;i<t.length;i++){for(var o=JSON.parse(JSON.stringify(e)),l=0;l<t[i].length;l++)o[t[i][l].x][t[i][l].y].flag=!0;isValidBoard(o)&&r.push(o)}return r}function chooseMostLikelyTile(){for(var e=!1,n=getSmallestBorderTileRegion(),t=getPossibleBoards(),r=getBoard(),i=0;i<n.length;i++){var o=n[i];o.aValue=0,r[o.x][o.y].aValue=0;for(var l=0;l<t.length;l++)t[l][o.x][o.y].flag&&(o.aValue++,r[o.x][o.y].aValue++)}var a=r.reduce(function(e,n){return e.concat(n)}).filter(function(e){return e.aValue});return a.sort(function(e,n){return e.aValue-n.aValue}),a[0]&&(e=!0),chooseTile(a[0]),e}var combine=function(e,n){for(var t=function(e,n,r,i){if(0==e)return void(r.length>0&&(i[i.length]=r));for(var o=0;o<n.length;o++)t(e-1,n.slice(o+1),r.concat([n[o]]),i)},r=[],i=n;i<e.length;i++)t(i,e,[],r);return r.push(e),r};setup();